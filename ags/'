import Battery from "./battery.js";
import Workspaces from "./hyprland.js";
import Network from "./network.js";
import Audio from "./audio.js";
const mpris = await Service.import("mpris");

const spotify_info = () => {
  const spotify = mpris.getPlayer("org.mpris.MediaPlayer2.spotify");
  const track_name = spotify?.track_title;
  const track_artist = spotify?.track_artists[0];
  const cover_path = spotify?.cover_path;

  return { track_name, track_artist, cover_path };
};

const Mpris = Widget.Box({
  vertical: true,
  child: Widget.Label().hook(
    mpris,
    (self) =>
      self.set_label(
        `${mpris.getPlayer("org.mpris.MediaPlayer2.spotify")?.track_title}`,
      ),
  ),
});

// Declaring the Window Menu
export const Window_Menu = Widget.Window({
  name: "Window-Menu",
  anchor: ["top", "right"],
  child: Widget.Box({
    css: "padding: 5px;",
    child: Widget.Revealer({
      revealChild: false,
      transition: "slide_down",
      transition_duration: 1000,
      child: Mpris,
    }),
  }),
});

const Utils = Widget.EventBox({
  hpack: "end",
  child: Widget.Box({
    children: [Network, Audio, Battery],
  }),
  on_hover: () => Window_Menu.child.child.set_reveal_child(true),
});

const Bar_Container = Widget.CenterBox({
  className: "container",
  startWidget: Workspaces,
  endWidget: Utils,
});

export default Widget.Window({
  exclusivity: "exclusive",
  child: Bar_Container,
  name: "Main-Bar",
  anchor: ["top", "left", "right"],
});
